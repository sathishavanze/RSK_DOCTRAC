<style type="text/css">
   .pd-btm-0 {
      padding-bottom: 0px;
   }

   .margin-minus8 {
      margin: -8px;
   }

   .mt--15 {
      margin-top: -15px;
   }

   .bulk-notes {
      list-style-type: none
   }

   .bulk-notes li:before {
      content: "*  ";
      color: red;
      font-size: 15px;
   }

   .nowrap {
      white-space: nowrap
   }

   .table-format>thead>tr>th {
      font-size: 12px;
   }


   .white-box {
      background: #ffffff;
      padding: 25px;
      margin-bottom: 15px;
   }

   .btn-outline {
      color: #fb9678;
      background-color: transparent;
   }

   .btn-danger.disabled {
      background: #fb9678;
      border: 1px solid #fb9678;
   }

   .exception {
      border: 1px dotted black;
      border-radius: 5px;
      padding-top: 10px;
      padding-bottom: 10px;
   }

   #iconc {
      float: right;
      margin-top: -19px;
   }

   .panel-heading-divider>p {
      border-bottom: 1px solid #d9d9d9;
      margin-left: 11px;
      padding-left: 0px;
      padding-right: 0;

      font-weight: 500px;

   }

   .panel-heading-divider {
      width: 100%;

   }

   .productadd_button {
      margin-top: -40px;
      font-size: 23px;
   }

   #Deleterow {
      margin-top: -40px;
      font-size: 23px;
   }

   #fromdate {
      margin-top: -28px;
   }

   #ToDate {
      margin-top: -28px;
   }

   .Borrower {
      width: 100%;
   }

   .bmd-form-group .bmd-label-floating,
   .bmd-form-group .bmd-label-placeholder {
      top: -18px;
   }

   input {
      margin-bottom: 5px;
   }

   .questionparagraph {
      margin: 0;
      padding: 0px;
      padding-left: 2px;
      font-size: 1.0em;
   }

   .questiondiv .form-control {
      font-size: 0.8em;
   }

   .mt-0 {
      margin-top: 0px !important;
   }

   .questions tr select {
      height: 25px !important;
   }

   .questions .form-group {
      margin: 0px !important;
      padding-bottom: 0px !important;
   }

   .questions textarea {
      line-height: 10px !important;
      font-size: 10px !important;
   }

   .questions>tbody>tr>td,
   .questions>tbody>tr>th,
   .questions>tfoot>tr>td,
   .questions>thead>tr>td {
      padding: 0px 2px !important;
   }

   .questions textarea::-webkit-input-placeholder {
      font-size: 10px !important;
   }

   .questions textarea:-moz-placeholder {
      /* Firefox 18- */
      font-size: 10px !important;
   }

   .questions textarea::-moz-placeholder {
      /* Firefox 19+ */
      font-size: 10px !important;
   }

   .questions textarea:-ms-input-placeholder {
      font-size: 10px !important;
   }

   .main-panel>.content {
      margin-top: 40px;
   }

   .mb-5 {
      margin-bottom: 5px !important;
   }

   .tab-pane .card-category {
      font-size: 12px !important;
      font-weight: 500 !important;
      color: #403f3f !important;
   }

   table.questions td:nth-child(4) {
      width: 8% !important;
   }

   table.questions td:nth-child(5) {
      width: 29% !important;
   }

   table.questions td:nth-child(2) {
      width: 50% !important;
   }

   .mb-0 {
      margin-bottom: 0px !important;
   }

   .ma-0 {
      margin: 0px !important;
   }

   .questionlist label {
      font-size: 10px !important;
      padding-left: 15px !important;
   }

   .questionlist .form-check .form-check-label .circle {
      height: 11px;
      width: 11px;
   }

   .questionlist .form-check .form-check-label .circle .check {
      height: 11px;
      width: 11px;
   }

   .questionlist p {
      font-size: 11px;
      font-weight: 500;
      padding-top: 5px;
      padding-bottom: 5px;
      line-height: 17px;
   }

   .questionlist textarea::placeholder {
      font-size: 10px !important;
   }


   .InputDocTypeQuestions#InputDocTypeQuestions {
      display: inline-block !important;
   }

   .expand_icon {
      position: relative;
   }

   .expand_icon i {
      font-size: 25px;
      right: 20px;
      top: -6px;
      cursor: pointer;
      position: absolute;
   }

   .questionlist {
      border-bottom: 1px solid #ddd;
      vertical-align: middle;
   }

   .checklisttable .form-control:read-only {
      background-image: none;
   }

   .bmd-form-group {
      padding-bottom: 0px;
   }

   .form-control:focus {
      border-color: #f44336;
   }

   .check_list_table>tbody>tr>td,
   .check_list_table>tbody>tr>th,
   .check_list_table>tfoot>tr>td,
   .check_list_table>thead>tr>td {
      white-space: normal;
      padding: 0 10px !important;
   }

   .questionlist select.form-control:not([size]):not([multiple]) {
      height: 25px;
      padding: 0;
      font-size: 10px;
      width: 95% !important;
   }

   .icon_minus_td .bmd-form-group {
      float: left;
      width: 92%;
   }


   .check_list_table thead tr th {
      padding: 4px 10px !important;
   }

   .custom_add_icon {
      font-weight: 600;
      text-decoration: underline;
      font-size: 11px;
      text-align: right;
      margin: 0;
      display: block;
      cursor: pointer;
      color: #1A73E8;
   }

   .checklisttable {
      /*margin-bottom:50px!important;*/
   }

   h6.pre_screen_head {
      padding: 7px 10px;
      font-size: 14px;
      margin: 0;
      font-weight: bold;
      background: #eee;
      color: #000;
   }

   .addnewchecklistpree {
      width: 100%;
      margin-bottom: 50px !important;
   }

   .move-handle-icon {
      cursor: grab;
   }

   .removeChecklist {
      cursor: pointer;
   }
</style>

<!-- Workflow module modal start-->
<div id="WorkflowModule" tabindex="-1" role="dialog" aria-hidden="true" class="modal fade" style="padding-left: 0px ! important;">
   <div class="modal-dialog modal-dialog-scrollable" style="margin: 1px 1px 1px 1px;">
      <div class="modal-content" style="left: 0;width: 1350px;right: 0;margin: 0;padding: 0;max-height: 655px ! important;">
         <div class="modal-header" style="padding: 10px !important;">
            <button type="button" data-dismiss="modal" aria-hidden="true" class="close modal-close"> <i class="icon-x"></i></button>
         </div>
         <div class="modal-body">
            <form action="#" name="orderform" id="frmordersummary">

               <?php $this->load->view('Ordersummary/Orderdetails'); ?>

               <!-- <div class="col-md-12 text-right" style="margin-top: 5px;">
                  <a class="allchecklisttableexport-xlsx">
                     <i class="fa fa-file-excel-o" title="Overall Queue Checklist Excel Export" aria-hidden="true" style="font-size:18px;color:#0B781C;cursor: pointer;"></i>
                  </a>

                  <a class="allchecklisttableexport-pdf" style="margin-left: 6px;">
                     <i class="fa fa-file-pdf-o" title="Overall Queue Checklist PDF Export" aria-hidden="true" style="font-size:18px;color:red;cursor: pointer;"></i>
                  </a>
               </div>

               <div class="dt-buttons btn-group" style="width: 100%;"> 
							<button class="btn btn-secondary buttons-excel buttons-html5 allchecklisttableexport-xlsx pull-right" tabindex="0" aria-controls="customerlisttable" type="button"><span>All Workflow Checklist Excel Export</span><div class="ripple-container"></div></button> 
							<button class="btn btn-secondary buttons-pdf buttons-html5 allchecklisttableexport-pdf pull-right" tabindex="0" aria-controls="customerlisttable" type="button"><span>All Workflow Checklist PDF Export</span></button> 
						</div> -->
               <div class="appendModalData"></div>
         </div>



         <!--div class="field_add">
            <div class="row mt-10">
               <div class="col-md-12">
                  <div class="row">
                  </div>
               </div>
            </div>
         </div>
         <div class="col-sm-12 form-group pull-right mt-20">
            <p class="text-right">
               <?php if ($OrderSummary->StatusUID != $this->config->item('keywords')['Cancelled']) { ?>
                  <button type="submit" class="btn btn-space btn-social btn-color btn-twitter checklist_update pull-right" value="1">Update</button>
               <?php } ?>
               <?php //$this->load->view('orderinfoheader/workflowbuttons'); 
               ?>

            </p>
         </div-->
         </form>
      </div>
   </div>
</div>
<!-- Workflow Module end-->
<script type="text/javascript" src="<?php echo base_url('assets/js/multiple-emails.js'); ?>"></script>

<script type="text/javascript" src="<?php echo base_url('assets/js/export/xlsx.full.min.js'); ?>"></script>

<script type="text/javascript" src="<?php echo base_url('assets/js/export/jspdf.min.js'); ?>"></script>

<script type="text/javascript" src="<?php echo base_url('assets/js/export/jspdf.plugin.autotable.js'); ?>"></script>
<script type="text/javascript">
   $(document).ready(function() {

      $(".order_expand_div").hide();

      $(".order_expand").click(function() {
         $(".order_expand_div").slideToggle();
      });

      $('.main-panel').scrollTop = 0;

      $('.perfectScrollbar').perfectScrollbar('update');

      $('.exception').hover(function() {
         $(this).addClass('btn-danger')
      }, function() {
         $(this).removeClass('btn-danger')
      });

      $('select.pre_select').select2();

      function OpenSelect2() {
         var $select2 = $(this).data('select2')
         setTimeout(function() {
            if (!$select2.opened()) {
               $select2.open();
            }
         }, 0);
      }


      $(document).off('click', '.addchecklistrowPreScreen').on('click', '.addchecklistrowPreScreen', function(e) {
         var workflowUId = $(this).attr('data-moduleUID');
         var count = Number($(this).attr('data-count')) + 1;
         var OrderUID = $('#OrderUID').val();
         $(this).attr('data-count', count);
         $.post('CommonController/get_newchecklistrow', {
            'OrderUID': OrderUID,
            'WorkflowModuleUID': workflowUId,
            'count': count
         }, function(result) {

            $('.addChecklist' + workflowUId).append(result);
            $('.addChecklist' + workflowUId).find('select.pre_select').select2();
            checklistdatepicker_init();

         });
      });
      $(document).off('click', '.addchecklistrow').on('click', '.addchecklistrow', function(e) {
         var workflowUId = $(this).attr('data-moduleUID');
         var count = Number($(this).attr('data-count')) + 1;
         var OrderUID = $('#OrderUID').val();
         $(this).attr('data-count', count);
         $.post('CommonController/get_newchecklistrow', {
            'OrderUID': OrderUID,
            'WorkflowModuleUID': workflowUId,
            'count': count
         }, function(result) {
            $('.addChecklist').append(result);
            $('.addChecklist').find('select.pre_select').select2();
            checklistdatepicker_init();

         });
      });

      // Export all workflow checklist as excel format
      $(document).off('click', '.btn-checklist-export-xlsx').on('click', '.btn-checklist-export-xlsx', function(event) {
         event.preventDefault();
         //export checklist table data to excel
         checklisttabledataexcel('.check_list_table');
      });

      // checklist pdf export start
		$(document).off("click", ".btn-checklist-export-pdf").on("click", ".btn-checklist-export-pdf", function (event) {
			event.preventDefault();
			// get checklist table id
			var checklisttableid = $(this).data("checklisttableid");
			
			//export checklist table data to pdf
			checklisttabledatapdf('.check_list_table');
		});
   });


   // excel export start
   // function get table data excel
   window.checklisttabledataexcel = function(table) {

      /* Import if no xlsx component is imported */
      if (typeof XLSX == 'undefined') XLSX = require('xlsx');

      /* Create a new empty workbook, then add the worksheet */
      var wb = XLSX.utils.book_new();

      //check_list_table
      var table = $(table);
      table.each(function() {
         // get checklist table id
         var checklisttableid = this.id; //Here this refers current table
         // get workflowtitle
         var sheet_name = $(this).attr("data-workflowtitle");

         //Get table heading as array
         var tableheading = [];
         $("#" + checklisttableid + " th:visible").each(function(index) {
            tableheading[index] = $(this).text();
         });

         //get checklist table data
         var records = [];
         var $headers = $("#" + checklisttableid + " th");
         var $rows = $("#" + checklisttableid + " tbody tr:visible").each(function(index) {
            $cells = $(this).find("td:visible");
            records[index] = {};
            $cells.each(function(cellIndex) {
               var tdval;
               if ($(this).find(".checklists").length) {
                  var tagName = $(this).find(".checklists").prop("tagName").toLowerCase();

                  if (tagName == 'select') {
                     var findings = $.trim($(this).find(".checklists :selected").text());

                     console.log(findings);
                     if (findings != 'empty') {
                        tdval = findings;
                     } else {
                        tdval = '';
                     }
                  } else if (tagName == 'textarea') {
                     tdval = $.trim($(this).find(".checklists").text());
                  } else if (tagName == 'input') {
                     var inputattrname = $(this).find(".checklists").attr("type");
                     if (inputattrname == "checkbox") {
                        if ($(this).find(".checklists").prop("checked") == true) {
                           IsChecklist = "Yes";
                        } else if ($(this).find(".checklists").prop("checked") == false) {
                           IsChecklist = "No";
                        }
                        tdval = IsChecklist;
                     } else if (inputattrname == "text") {
                        tdval = $.trim($(this).find(".checklists").val());
                     } else {
                        tdval = $.trim($(this).find(".checklists").text());
                     }
                  } else {
                     tdval = $.trim($(this).find(".checklists").text());
                  }
               } else {
                  tdval = $.trim($(this).text());
               }
               records[index][$($headers[cellIndex]).text()] = tdval;
            });
         });

         /* Create a worksheet */
         var ws = XLSX.utils.json_to_sheet(records, {
            header: tableheading
         });

         /* add the worksheet */
         XLSX.utils.book_append_sheet(wb, ws, sheet_name);
      });

      /* Generate xlsx files */
      XLSX.writeFile(wb, exportfilenamingstandard() + ".xlsx");
   }

   $(function() {
      window.exportfilenamingstandard = function() {
         // <<LoanNumber>>_mm/dd/yy
         var fullDate = new Date();
         //var LoanNumber=$('#LoanNumber').val();alert(LoanNumber);
         //convert month to 2 digits
         var twoDigitMonth = ((fullDate.getMonth().length + 1) === 1) ? (fullDate.getMonth() + 1) : '0' + (fullDate.getMonth() + 1);

         var currentDate = twoDigitMonth + "/" + fullDate.getDate() + "/" + fullDate.getFullYear();
         return 'Checklist_' + currentDate;
      };
   });


   // function get table data
   window.checklisttabledatapdf = function(table) {

      // initialize jspdf
      const doc = new jsPDF('p', 'pt', 'letter');

      //check_list_table
      var table = $(table);

      var count = 1;
      table.each(function() {
         // get checklist table id
         var checklisttableid = this.id; //Here this refers current table

         // get workflowpdftitle
         var workflowpdftitle = $(this).attr("data-workflowpdftitle");

         //Get table heading as array
         var tableheading = [];
         var $headers = $("#" + checklisttableid + " th");
         $headers.each(function(key, val) {
            tableheading[key] = $(this).text();
         });

         //get table data
         var records = [];
         var $headers = $("#" + checklisttableid + " th");
         var $rows = $("#" + checklisttableid + " tbody tr:visible").each(function(index) {
            $cells = $(this).find("td:visible");
            records[index] = [];
            $cells.each(function(cellIndex) {
               var tdval;
               if ($(this).find(".checklists").length) {
                  var tagName = $(this).find(".checklists").prop("tagName").toLowerCase();
                  if (tagName == 'select') {
                     var findings = $.trim($(this).find(".checklists :selected").text());
                     if (findings != 'empty') {
                        tdval = findings;
                     } else {
                        tdval = '';
                     }
                  } else if (tagName == 'textarea') {
                     tdval = $.trim($(this).find(".checklists").text());
                  } else if (tagName == 'input') {
                     var inputattrname = $(this).find(".checklists").attr("type");
                     if (inputattrname == "checkbox") {
                        if ($(this).find(".checklists").prop("checked") == true) {
                           IsChecklist = "Yes";
                        } else if ($(this).find(".checklists").prop("checked") == false) {
                           IsChecklist = "No";
                        }
                        tdval = IsChecklist;
                     } else if (inputattrname == "text") {
                        tdval = $.trim($(this).find(".checklists").val());
                     } else {
                        tdval = $.trim($(this).find(".checklists").text());
                     }
                  } else {
                     tdval = $.trim($(this).find(".checklists").text());
                  }
               } else {
                  tdval = $.trim($(this).text());
               }
               records[index][cellIndex] = tdval;
            });
         });
         var output_data = [];
         output_data = records;

         if (count != 1) {
            // Add new page		
            doc.addPage();
         }
         count++;

         doc.setFontType("bold");
         doc.setFontSize(12);
         doc.text(40, 30, workflowpdftitle);

         // Or use javascript directly:
         doc.autoTable({
            head: [tableheading],
            body: output_data,
         });

      });

      doc.save(exportfilenamingstandard() + '.pdf');
   }
   // pdf export end
   var $btnDLtoExcel = $('.btn-checklist-export-xlsx');
   $btnDLtoExcel.on('click', function(event) {
      alert();
      event.preventDefault();
      // get checklist table id
      var checklisttableid = $(this).data("checklisttableid");

      //export checklist table data to excel
      checklisttabledataexcel('#' + checklisttableid);

   });
</script>